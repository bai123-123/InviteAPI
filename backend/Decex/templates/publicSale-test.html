<!DOCTYPE html>

<html lang="en">

<head>

    <title>Public Sale</title>

    <!-- 设置文档编码 -->

    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">

    <!-- -->

    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">


    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->

    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
            crossorigin="anonymous"></script>

    <!-- 新 Bootstrap 核心 CSS 文件 -->

    <link rel="stylesheet" href="../static/css/bootstrap.css" type="text/css">


    <!-- 外部样式 style.css -->
    <link rel="stylesheet" href="../static/css/style.css" type="text/css">

    <style>
        body {
            background-image: url("../static/img/bbb20-min1.jpg");
            background-repeat: no-repeat;
            background-size: 100%;
            background-color: #0c62af;
        }
    </style>
</head>

<body>
<header>
    <!-- Image and text -->
    <nav class="navbar navbar-expand-md fixed-top navbar-light" style="background-color: #000000c0;">
        <a class="navbar-brand" href="../templates/index.html" style="color: #ffffff">
            <img src="../static/img/Logo1.svg" width="30" height="30" class="d-inline-block align-top" alt=""
                 loading="lazy">
            DeCEX
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown"
                aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a href="publicSale.html#publicsale" class="nav-link1">Public Sale</a>
                </li>
                <li class="nav-item">
                    <a href="nft.html" class="nav-link1">NFTs</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" style="color: #dddddd">DCX Farming</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" id="navbarDropdown" role="button" data-bs-toggle="dropdown"
                       aria-expanded="false" style="color: #dddddd;">
                        NFT Ecosystem
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <li><a class="dropdown-item">NFT Auction</a></li>
                        <li><a class="dropdown-item">NFT Farming</a></li>
                        <li><a class="dropdown-item">NFT Gaming</a></li>
                    </ul>
                </li>
                <li class="nav-item" style="text-align: center;">
                    &nbsp;
                    <a href="https://drive.google.com/file/d/1YVWkbCoFJo-jvC1imMVDxCEtzIrNnLpN/view?usp=sharing"
                       class="btn btn-primary" style="color: #ffffff;">
                        Whitepaper</a>
                </li>
                &nbsp;
                <li class="nav-item" style="text-align: center;">
                    &nbsp;
                    <a href="../static/DeСEXauditreport.pdf" class="btn btn-primary" tabindex="-1" role="button"
                       aria-disabled="true">
                        Audit</a>
                </li>
            </ul>
        </div>
    </nav>
</header>
<section style="margin-top: 2.3cm;">
    <div class="container">
        <div class="row justify-content-end">
            <div class="col-4-md" style="padding: 0px; text-align: center;">
                <div class="adjust">
                    <button type="button" class="btn btn-dark"
                            onclick="document.getElementById('light').style.display='block';document.getElementById('fade').style.display='block'">
                        <img src="../static/img/wallet.svg" width="23" height="23">
                        Unlock Wallet
                    </button>
                </div>
            </div>
        </div>
        <div class="row justify-content-around" id="popBox-wallet">
            <div id="light" class="white_content" style="text-align: center">
                <div style="text-align: right;">
                    <input type="button" value="X" class="btn btn-close btn-lg"
                           onclick="document.getElementById('light').style.display='none';"/>
                </div>
                <h4 style="margin-top: -0.3cm; margin-bottom: 2cm;">Unlock Your Wallet</h4>
                <button class="metaMaskEnableButton">Metamask</button>
            </div>
        </div>

    </div>
</section>

<section style="margin-top: 1cm;">
    <div class="container">
        <div class="row justify-content-center" style="margin-top: 2cm;">
            <div class="col-lg" style="vertical-align: middle;">

                <h1 style="color: #ffffff;" id="airDropPos">Airdrop Claim</h1>
                <p style="color: #ffffff; margin-top: 1.5cm;margin-bottom: 1cm;">
                    We chose 1000 winners randomly from all participants.
                </p>
                <a href="https://drive.google.com/file/d/1FQADfuMT_P8SZU6xJro7d_eYizpbuA2w/view?usp=sharing"
                   style="color: #ffffff; font-size: 18px;">
                    <img src="../static/img/excel.png" width="100%" style="min-width: 30px;max-width: 30px;">&nbsp;
                    DeCEXPublicAirdropRegistration.csv
                </a>
                <p style="color: #ffffff; margin-top: 0.2cm; margin-bottom: 1cm;font-size: 18px;">
                    <img src="../static/img/excel.png" width="100%" style="min-width: 30px;max-width: 30px;">&nbsp;
                    DeCEXPublicAirdropWinner.csv
                </p>

            </div>
            <div class="col" style="vertical-align: middle;text-align: center;">
                <div><img src="../static/img/airdrop.png" width="100%" style="min-width: 180px;max-width: 250px;">
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row justify-content-center" style="margin-top: 1cm;">
            <div class="col-lg">
                <h5 style="color: #ffffff; margin-top: 1cm;">
                    Click "Check" to check your airdrop balance
                </h5>
                <h5 style="color: #ffffff; margin-top: 0.5cm;">
                    Your Airdrop Balance:
                </h5>
                <button type="check" class="btn btn-warning checkAirdropInvokeButton"
                        style="font-size: 20px; margin-top: 0.5cm;color: #ffffff;">Check
                </button>
            </div>
            <div class="col-lg">
                <h5 style="color: #ffffff; margin-top: 1cm;">
                    Click "Claim" to claim your airdrop
                </h5>
                <h5 style="color: #ffffff; margin-top: 0.5cm;">
                    &nbsp;
                </h5>
                <button type="claim" class="btn btn-warning claimAirdropInvokeButton"
                        style="font-size: 20px; margin-top: 0.5cm;color: #ffffff;" disabled>Claim
                </button>
            </div>
        </div>
    </div>
</section>

<section>
    <div class="container">
        <h1 style="color: #ffffff; margin-top: 2.5cm;" id="publicSellPos">Public Token Sale</h1>
        <p style="color: #ffffff; margin-top: 1.5cm;">
            DeCEX is an innovative platform that seamlessly integrates together the universes of DeFi and NFTs,
            bringing together NFT gaming, NFTswap and NFT vault all in one ecosystem.
            Public Token Sale is coming Soon.</p>
    </div>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-xl">
                <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3" style="margin-top: 1cm;">
                    <div class="col">
                        <div class="card"
                             style="margin:20px 20px 20px 20px; text-align: center; background-color: #00000050;">
                            <div class="card-body" style="color: #ffffff;">
                                <h5 class="card-title">Token Price</h5>
                                <p class="card-text">1ETH = 650DCX</p>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card"
                             style="margin:20px 20px 20px 20px; text-align: center; background-color: #00000050;">
                            <div class="card-body" style="color: #ffffff;">
                                <h5 class="card-title">Total Supply</h5>
                                <p class="card-text">1,000,000DCX</p>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card"
                             style="margin:20px 20px 20px 20px; text-align: center; background-color: #00000050;">
                            <div class="card-body" style="color: #ffffff;">
                                <h5 class="card-title">Token Contract</h5>
                                <a href="https://etherscan.io/address/0x2A3a8F2d0487fbf654cd530B5F0A1d9467935D6a">View
                                    Here</a>
                            </div>
                        </div>
                    </div>


                    <div class="col">
                        <div class="card"
                             style="margin:20px 20px 20px 20px; text-align: center; background-color: #00000050;">
                            <div class="card-body" style="color: #ffffff;">
                                <h5 class="card-title">Token Hard Cap</h5>
                                <p class="card-text">800ETH</p>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card"
                             style="margin:20px 20px 20px 20px; text-align: center; background-color: #00000050;">
                            <div class="card-body" style="color: #ffffff;">
                                <h5 class="card-title">Token Soft Cap</h5>
                                <p class="card-text">500ETH</p>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card"
                             style="margin:20px 20px 20px 20px; text-align: center; background-color: #00000050;">
                            <div class="card-body" style="color: #ffffff;">
                                <h6 class="card-title">Uniswap List Price</h6>
                                <p class="card-text">1ETH=400DCX</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col">
                    <form style="margin-top:0.5cm; text-align: center">
                        <div class="mb-3；text-align: center">
                            <label for="exampleInputEmail1" class="form-label"
                                   style="color: #ffffff;font-size: 25px;">
                                ETH Amount(0.1-10ETH)</label>
                            <div>
                                <input style="width: 300px; text-align: right;font-size: 25px; margin-top:0.3cm"
                                       type="amount" id="amountETH" aria-describedby="emailHelp"
                                       oninput="value=value.replace(/^\D*(\d*(?:\.\d{0,1})?).*$/g, '$1');if(value>50)value=50;if(value<0)value=0">

                            </div>

                            <div style="margin-top: 0.5cm;margin-bottom: 0.5cm;padding-right:0cm">
                                <button type="button" class="btn btn-light"
                                        style="margin-right: 2cm;font-size: 20px"
                                        onclick="document.getElementById('amountETH').value='1';">&nbsp;1&nbsp;
                                </button>
                                <button type="button" class="btn btn-light"
                                        style="margin-right: 2cm;font-size: 20px"
                                        onclick="document.getElementById('amountETH').value='5';">&nbsp;5&nbsp;
                                </button>
                                <button type="button" class="btn btn-light" style="font-size: 20px"
                                        onclick="document.getElementById('amountETH').value='10';">10
                                </button>
                            </div>
                            <div>
                                <button class="btn btn-warning publicBuyInvokeButton"
                                        style=" margin-bottom: 0.3cm; font-size: 25px; color: #ffffff;" type="button">
                                    &nbsp;&nbsp;Buy&nbsp;&nbsp;
                                </button>
                            </div>
                        </div>

                    </form>
                </div>
            </div>
            <div class="col-xs">
                <img class="pieChart" src="../static/img/pieChart6.png" style="margin-top:1.5cm" width="339px"
                     height="455px">
            </div>

        </div>
    </div>
</section>

<section>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col">
                <h1 style="color: #ffffff; margin-top: 2.5cm;">Referral Link</h1>
                <p style="color: #ffffff; margin-top: 1.5cm;">
                    The user who buy tokens or claim airdrop can get a unique referral link.
                    If someone buy DCX through your link, you will get 5% bonus of the purchase amount.</p>
            </div>
            <div class="col" style="text-align: center;">
                <div><img src="../static/img/referral1.png" width="100%"
                          style="min-width: 150px;max-width: 200px;margin-top: 2.5cm;">
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row justify-content-center" style="margin-top: 0cm;">
            <div class="col-lg">
                <h5 style="color: #ffffff; margin-top: 1cm;">
                    Click "Get Link" to get your referral link
                </h5>
                <h5 style="color: #ffffff; margin-top: 0.5cm;">
                    Your Referral Link:
                </h5>
                <button type="GetLink" class="btn btn-warning getRefLinkButton"
                        style="font-size: 20px; margin-top: 0.5cm;color: #ffffff;">Get Link
                </button>

                <input type="text" id="referLinkRange">
            </div>
            <div class="col-lg">
                <h5 style="color: #ffffff; margin-top: 1cm;">
                    Click "Check" to check your referral balance
                </h5>
                <h5 style="color: #ffffff; margin-top: 0.5cm;">
                    Your Referral Balance:
                </h5>
                <button type="check" class="btn btn-warning checkRefBalanceButton"
                        style="font-size: 20px; margin-top: 0.5cm;color: #ffffff;">Check
                </button>

                <input type="text" id="rewardCheckRange">
            </div>
        </div>
    </div>
</section>

<section style="background-color: #000000c0;">
    <div class="container">
        <div class="row justify-content-center" style="margin-top: 3cm;margin-bottom: 1cm;">
            <div class="col-2">
                <div class="icon1" style="margin-top: 1cm;">
                    <a href="https://t.me/DeCEXofficial" style="color: #00000000;">
                        bbb
                    </a>
                </div>
            </div>
            <div class="col-2">
                <div class="icon2" style="margin-top: 1cm;">
                    <a href="https://twitter.com/decexfinance" style="color: #00000000;">
                        bbb
                    </a>
                </div>
            </div>
            <div class="col-2">
                <div class="icon3" style="margin-top: 1cm;">
                    <a href="https://medium.com/@decexfinance" style="color: #00000000;">
                        bbb
                    </a>
                </div>
            </div>
            <div class="col-2">
                <div class="icon4" style="margin-top: 1cm;">
                    <a href="https://github.com/DecexFinanace/DeCex-token" style="color: #00000000;">
                        bbb
                    </a>
                </div>
            </div>
            <div class="col-2">
                <div class="icon5" style="margin-top: 1cm;">
                    <a href="https://etherscan.io/address/0x2A3a8F2d0487fbf654cd530B5F0A1d9467935D6a"
                       style="color: #00000000;">
                        bbb
                    </a>
                </div>
            </div>
        </div>

        <div class="row justify-content-center" style="margin-top: 0.5cm; padding-right: 70px;">
            <div class="col" style="text-align: right;">
                <img src="../static/img/Logo1.svg" width="80" height="80" class="d-inline-block align-top" alt=""
                     loading="lazy">
            </div>
            <div class="col" style="text-align: left;margin-left: -50px;">
                <img src="../static/img/white.png" width="150" class="d-inline-block align-top" loading="lazy">
            </div>
        </div>

        <div class="row justify-content-center" style="margin-top: 1cm;padding-bottom: 1cm;">
            <a href="mailto:admin@decex.finance" style="color: #dddbdb;">
                admin@decex.finance
            </a>
        </div>
    </div>
    <div id="inviteCode" style="visibility: hidden">{{ request.session.inviteCode }}</div>
</section>
</body>

</html>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>
<script>
    let currentAccount;
    let web3MetaMask;
    let airDropBalance;
    let receiptHash;
    let inviteCode;


    const airDropAddress = '0xC520feEa950b8A38c82E00d89f21D164c5ffC89F';
    const publicSaleAddress = '0xaCBf833CfaB2ce382DE26Df21cb11a90f246675F';

    const checkAirdropInvokeButton = document.querySelector('.checkAirdropInvokeButton');
    const claimAirdropInvokeButton = document.querySelector('.claimAirdropInvokeButton');
    const publicBuyInvokeButton = document.querySelector('.publicBuyInvokeButton');
    const metaMaskEnableButton = document.querySelector('.metaMaskEnableButton');
    const getRefLinkButton = document.querySelector('.getRefLinkButton');
    const checkRefBalanceButton = document.querySelector('.amountETH');


    window.addEventListener('load', async () => {

        //query if address had receiptHash in dataBase
        //if true enable the getlink and check balance button


        ethereum.autoRefreshOnNetworkChange = false;
        if (window.ethereum) {
            web3MetaMask = new Web3(window.ethereum);
        } else if (window.web3) {
            ///other wallet except metamask
            // web3OthersWallet = new Web3(window.web3.currentProvider);
            resolve(web3);
        } else {
            ///no wallet connected
        }

        sessionStorage.setItem('inviteCode','{{ request.session.inviteCode }}');

        // var myName = $.session.get();
        // alert(myName);
    });

    function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split("=");
            if (pair[0] == variable) {
                return pair[1];
            }
        }
        return (false);
    }


    metaMaskEnableButton.addEventListener('click', async () => {
        if (typeof window.ethereum !== 'undefined') {
            console.log('MetaMask is installed!');

            getAccount_metaMask();
        } else {
            console.log('Please install MetaMask');
        }

    });

    async function getAccount_metaMask() {
        const accounts = await ethereum.request({method: 'eth_requestAccounts'});
        currentAccount = accounts[0];
    }

    ethereum.on('accountsChanged', function (accounts) {
        currentAccount = ethereum.selectedAddress;
        // web3MetaMask.eth.defaultAccount = currentAccount;
        // Time to reload your interface with accounts[0]!
    })


    checkAirdropInvokeButton.addEventListener('click', async () => {
        const airDropAbi = [
            {
                "constant": false,
                "inputs": [],
                "name": "claimPublicAirdrop",
                "outputs": [
                    {
                        "internalType": "bool",
                        "name": "",
                        "type": "bool"
                    }
                ],
                "stateMutability": "nonpayable",
                "type": "function"

            },
            {
                "constant": false,
                "inputs": [],
                "name": "publicAirdropStatus",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    },
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "constant": false,
                "inputs": [],
                "name": "queryReward",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"

            }
        ];
        if (window.ethereum) {
            try {
                web3MetaMask.eth.defaultAccount = currentAccount;
                const contract = await new web3MetaMask.eth.Contract(airDropAbi, airDropAddress);
                airDropBalance = await contract.methods.queryReward().call({from: ethereum.selectedAddress});
                console.log(airDropBalance);
                if (airDropBalance > 0) {
                    claimAirdropInvokeButton.disabled = false;
                }

            } catch (e) {
                console.log(e);
            }
        } else if (window.web3) {
            ////other wallets
        }
    });


    claimAirdropInvokeButton.addEventListener('click', async () => {
            const airDropAbi = [
                {
                    "constant": false,
                    "inputs": [],
                    "name": "claimPublicAirdrop",
                    "outputs": [
                        {
                            "internalType": "bool",
                            "name": "",
                            "type": "bool"
                        }
                    ],
                    "stateMutability": "nonpayable",
                    "type": "function"

                },
                {
                    "constant": false,
                    "inputs": [],
                    "name": "publicAirdropStatus",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        },
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "constant": false,
                    "inputs": [],
                    "name": "queryReward",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"

                },
                {
                    "constant": false,
                    "inputs": [],
                    "name": "publicAddLiquidity",
                    "outputs": [
                        {
                            "internalType": "bool",
                            "name": "",
                            "type": "bool"
                        }
                    ],
                    "stateMutability": "payable",
                    "type": "function"

                },
            ];

            if (window.ethereum) {
                try {
                    web3MetaMask.eth.defaultAccount = currentAccount;
                    const contract = await new web3MetaMask.eth.Contract(airDropAbi, airDropAddress);
                    contract.methods.claimPublicAirdrop().send({from: ethereum.selectedAddress})
                        .on('transactionHash', function (hash) {
                        })
                        .on('confirmation', function (confirmationNumber, receipt) {
                        })
                        .on('receipt', function (receipt) {
                            receiptHash = receipt.transactionHash;
                            getRefLinkButton.disabled = false;
                            console.log(receiptHash);
                            ///upload buyer's transactionHash
                            //upload buyer's invotelinkcode = last transactionHash
                        })
                        .on('error', function (error, receipt) { // If the transaction was rejected by the network with a receipt, the second parameter will be the receipt.
                            console.log(error);
                        });

                } catch
                    (e) {
                    console.log(e);
                }
            } else if (window.web3) {
                ////other wallets
            }

            claimAirdropInvokeButton.disabled = true;

        }
    );

    publicBuyInvokeButton.addEventListener('click', async () => {
        var ethInput = document.getElementById('amountETH').value;
        const publicSellAbi = [
            {
                "constant": false,
                "inputs": [],
                "name": "publicSellStatus",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    },
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"

            },
            {
                "constant": false,
                "inputs": [],
                "name": "publicBuy",
                "outputs": [],
                "stateMutability": "payable",
                "type": "function"
            },
            {
                "constant": false,
                "inputs": [],
                "name": "_PublicSellStageOneRate",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"

            },
            {
                "constant": false,
                "inputs": [],
                "name": "_PublicSellStageTwoRate",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            }
        ];
        // console.log('click buyyyy');
        //
        // var httpRequest = new XMLHttpRequest();
        // httpRequest.open('POST', 'http://127.0.0.1:8000/runJob/', true);
        // httpRequest.setRequestHeader("Content-type", "application/json");

        web3.eth.getTransaction('0x654a270911b77ce934dfa44e5d3ec5685f34d2c954ea5af130d9d13fa8025d8a', function (err, receipt) {
            if (!err) {
                console.log(receipt);

                let inviter = sessionStorage.getItem('inviteCode');


                httpRequest.send(JSON.stringify({
                    "buyer": currentAccount,
                    "transaction": receipt,
                    "receiptHash": '0x654a270911b77ce934dfa44e5d3ec5685f34d2c954ea5af130d9d13fa8025d8a',
                    "inviter": inviter
                }));

            }
        //
        //
        // });


        //
        //
        // httpRequest.onreadystatechange = function () {//请求后的回调接口，可将请求成功后要执行的程序写在其中
        //     if (httpRequest.readyState == 4 && httpRequest.status == 200) {//验证请求是否发送成功
        //         var json = httpRequest.responseText;//获取到服务端返回的数据
        //         console.log(json);
        //     }
        // };
        // return false;


        if (ethInput > 0 && ethInput < 10) {
            if (window.ethereum) {
                try {
                    console.log(ethInput);
                    web3MetaMask.eth.defaultAccount = currentAccount;
                    const contract = await new web3MetaMask.eth.Contract(publicSellAbi, publicSaleAddress);
                    contract.methods.publicBuy().send({
                        from: ethereum.selectedAddress,
                        value: ethInput * 1000000000000000000
                    })
                        .on('transactionHash', function (hash) {
                        })
                        .on('confirmation', function (confirmationNumber, receipt) {
                        })
                        .on('receipt', function (receipt) {
                            receiptHash = receipt.transactionHash;
                            publicBuyInvokeButton.disabled = false;
                            console.log(receiptHash);
                            console.log(ethereum.selectedAddress);
                            ///upload buyer's transactionHash
                            // post_buyResult(ethereum.selectedAddress,receiptHash);


                        })
                        .on('error', function (error, receipt) { // If the transaction was rejected by the network with a receipt, the second parameter will be the receipt.
                            console.log(error);
                        });

                } catch (e) {
                    console.log(e);
                }
            } else if (window.web3) {
                ////other wallets
            }
        }
    });


    async function post_buyResult(buyer, receiptHash) {
        var httpRequest = new XMLHttpRequest();
        httpRequest.open('POST', 'http://127.0.0.1:8000/runJob/', true);
        httpRequest.setRequestHeader("Content-type", "application/json");

        var receipt = await web3.eth.getTransactionReceipt(receiptHash);

        httpRequest.send(JSON.stringify({
            "buyer": buyer,
            "receipt": receipt,
            "inviter": invier
        }));


        httpRequest.onreadystatechange = function () {//请求后的回调接口，可将请求成功后要执行的程序写在其中
            if (httpRequest.readyState == 4 && httpRequest.status == 200) {//验证请求是否发送成功
                var json = httpRequest.responseText;//获取到服务端返回的数据
                console.log(json);
            }
        };
        return false;
    }

    String.prototype.format = function () {
        if (arguments.length == 0)
            return this;
        for (var s = this, i = 0; i < arguments.length; i++)
            s = s.replace(new RegExp("\\{" + i + "\\}", "g"), arguments[i]);
        return s;
    };


    getRefLinkButton.addEventListener('click', async () => {
        console.log(inviteCode);
        document.getElementById("referLinkRange").value = 'http://127.0.0.1:8000/invite/?inviteCode=' + currentAccount;
    });


    // checkRefBalanceButton.addEventListener('click', async () => {
    //     //query address's reward from inviteLink (may have two receiptHash add them all)
    //     //show balance
    //
    // });


    ethereum.on('accountsChanged', function (accounts) {
        currentAccount = ethereum.selectedAddress;
        web3MetaMask.eth.defaultAccount = currentAccount;
        // Time to reload your interface with accounts[0]!
    })


</script>